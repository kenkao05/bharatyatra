<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Travel Spot Suggestion Form</title>
  <style>
    :root{
      --bg:#F8F4EC; /* cream beige */
      --card:#F5EFEB; /* light beige */
      --accent:#B8A992; /* warm beige */
      --muted:#8A7D6C; /* dark beige/taupe */
      --glass: rgba(212, 199, 178, 0.3); /* beige glass effect */
      --radius:14px;
      font-family: 'Georgia', 'Times New Roman', serif;
    }

    html,body{height:100%;}
    body{
      margin:0;
      background:linear-gradient(180deg, #F8F4EC 0%, #F5EFEB 100%);
      color:#5A4F41;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px;
    }

    /* Fixed back button - only top right positioning */
    .back-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 1.2rem;
      background: rgba(184, 169, 146, 0.6);
      color: #5A4F41;
      font-weight: 600;
      border-radius: 30px;
      text-decoration: none;
      box-shadow: 0 4px 12px rgba(90, 79, 65, 0.15);
      transition: all 0.3s ease;
      border: 1px solid rgba(212, 199, 178, 0.4);
      backdrop-filter: blur(8px);
      cursor: pointer;
    }

    .back-btn:hover {
      transform: translateX(-5px);
      background: rgba(212, 199, 178, 0.8);
      box-shadow: 0 6px 18px rgba(90, 79, 65, 0.2);
    }

    .card{
      width:100%;
      max-width:820px;
      background: rgba(248, 244, 236, 0.7);
      border-radius:var(--radius);
      padding:28px;
      box-shadow: 0 10px 30px rgba(90, 79, 65, 0.15);
      border:1px solid rgba(212, 199, 178, 0.3);
      backdrop-filter: blur(12px);
    }

    h1{margin:0 0 8px 0;font-size:20px;color:#7A6A57;}
    p.lead{margin:0 0 20px 0;color:var(--muted);font-size:14px}

    .grid{
      display:grid;
      gap:24px;
      grid-template-columns: 1fr 1fr;
    }

    label{display:block;font-size:13px;margin-bottom:8px;color:var(--muted)}

    input[type="text"], input[type="url"], textarea, .file-input, select {
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      background: rgba(232, 223, 208, 0.5);
      border:1px solid rgba(212, 199, 178, 0.4);
      color:#5A4F41;
      font-size:14px;
      outline:none;
      transition:box-shadow .12s, border-color .12s, background-color .12s;
      box-sizing: border-box;
      font-family: 'Georgia', 'Times New Roman', serif;
    }

    select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%235A4F41' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      padding-right: 40px;
    }

    select:disabled {
      cursor: not-allowed;
      opacity: 0.6;
      background-color: rgba(232, 223, 208, 0.3);
    }

    input:focus, textarea:focus, select:focus{ 
      box-shadow:0 6px 18px rgba(184, 169, 146, 0.2); 
      border-color: rgba(184, 169, 146, 0.6);
      background: rgba(232, 223, 208, 0.7);
    }

    textarea{min-height:120px;resize:vertical}

    .file-row{display:flex;gap:12px;align-items:center}
    .file-preview{
      width:120px;
      height:80px;
      border-radius:8px;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(232, 223, 208, 0.6);
      border:1px dashed rgba(212, 199, 178, 0.6);
      color: var(--muted);
      font-size: 12px;
    }
    .file-preview img{max-width:100%;max-height:100%;display:block}

    .controls{display:flex;gap:12px;align-items:center;margin-top:18px}
    .btn{
      padding:10px 14px;
      border-radius:10px;
      border:0;
      cursor:pointer;
      font-weight:600;
      font-size:14px;
      font-family: 'Georgia', 'Times New Roman', serif;
      transition: all 0.3s ease;
    }
    .btn-primary{
      background:linear-gradient(90deg, #B8A992, #D4C7B2);
      color:#5A4F41;
      box-shadow: 0 2px 8px rgba(184, 169, 146, 0.3);
    }
    .btn-primary:hover{
      background:linear-gradient(90deg, #D4C7B2, #E8DFD0);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(184, 169, 146, 0.4);
    }
    .btn-ghost{
      background:transparent;
      border:1px solid rgba(212, 199, 178, 0.6);
      color:var(--muted);
    }
    .btn-ghost:hover{
      background: rgba(212, 199, 178, 0.3);
      border-color: rgba(184, 169, 146, 0.8);
    }

    .small{font-size:13px;color:var(--muted)}

    /* responsive */
    @media (max-width:720px){
      .grid{grid-template-columns:1fr;gap:18px;}
      .file-preview{display:none}
      .card{padding:18px}
      .back-btn{
        top: 15px;
        right: 15px;
        padding: 0.4rem 0.8rem;
        font-size: 14px;
      }
    }

    .footnote{margin-top:16px;color:var(--muted);font-size:13px}
    .notice{
      margin-top:12px;
      padding:10px;
      border-radius:10px;
      background: rgba(184, 169, 146, 0.2);
      color: #7A6A57;
      font-size:13px;
      border: 1px solid rgba(212, 199, 178, 0.4);
    }

    .notice.success{
      background: rgba(139, 195, 139, 0.2);
      color: #3d5a3d;
      border-color: rgba(139, 195, 139, 0.4);
    }

    input::placeholder, textarea::placeholder {
      color: #A69782;
      opacity: 0.8;
    }

    .required{color:#B8695F;font-weight:bold;margin-left:2px;}
  </style>
</head>
<body>
  <a href="../index.html" class="back-btn" id="backBtn">
    ← Back
  </a>

  <main class="card" role="main">
    <h1>Suggest a Travel Spot</h1>
    <p class="lead">Share a place you'd recommend with details about location, description, map link and a photo.</p>

  <form id="suggestForm" action="take_submissions.php" method="post" enctype="multipart/form-data" novalidate>
      <div class="grid">
        <!-- State Selection -->
        <div>
          <label for="spotState">State <span class="required">*</span></label>
          <select id="spotState" name="spot_state" required>
            <option value="">Select state</option>
            <option value="Gujarat">Gujarat</option>
            <option value="Rajasthan">Rajasthan</option>
            <option value="Assam">Assam</option>
            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
            <option value="Kerala">Kerala</option>
          </select>
        </div>

        <!-- District Selection -->
        <div>
          <label for="spotDistrict">District <span class="required">*</span></label>
          <select id="spotDistrict" name="spot_district" required disabled>
            <option value="">Select state first</option>
          </select>
        </div>

        <!-- Spot Name -->
        <div style="grid-column:1 / -1">
          <label for="spotName">Spot name <span class="required">*</span></label>
          <input type="text" id="spotName" name="spot_name" required placeholder="e.g. Statue of Unity, Sabarmati Ashram" />
        </div>

        <!-- Description -->
        <div style="grid-column:1 / -1">
          <label for="description">Description <span class="required">*</span></label>
          <textarea id="description" name="description" required placeholder="Why should someone visit? Include special tips, best time to go, entry fees, accessibility..." maxlength="800"></textarea>
        </div>

        <!-- Google Maps Link -->
        <!-- (map link removed — suggestions table doesn't store map links) -->

        <!-- Photo Upload -->
        <div>
          <label for="photo">Upload photo</label>
          <div class="file-row">
            <div class="file-input-wrap" style="flex:1">
              <input class="file-input" type="file" id="photo" name="image" accept="image/*" />
              <div class="small">Optional: jpg, png. Max 10MB</div>
            </div>
            <div class="file-preview" id="preview">Preview</div>
          </div>
        </div>

      </div>

      <div class="controls">
        <button type="submit" class="btn btn-primary">Submit suggestion</button>
        <button type="button" class="btn btn-ghost" id="clearBtn">Clear</button>
        <div style="flex:1"></div>
        <div class="small">Fields marked with <span class="required">*</span> are required</div>
      </div>

      <div id="message" class="notice" style="display:none"></div>
      <div class="footnote">Thanks — your suggestion helps other travellers discover amazing spots!</div>
    </form>
  </main>

    <script>
    const form = document.getElementById('suggestForm');
    const preview = document.getElementById('preview');
    const photo = document.getElementById('photo');
    const backBtn = document.getElementById('backBtn');
    const message = document.getElementById('message');
    const clearBtn = document.getElementById('clearBtn');
    const stateSelect = document.getElementById('spotState');
    const districtSelect = document.getElementById('spotDistrict');

    // Show server status if redirected back
    (function showServerStatus(){
      const params = new URLSearchParams(window.location.search);
      if(params.has('status')){
        const status = params.get('status');
        if(status === 'success'){
          message.style.display = 'block';
          message.className = 'notice success';
          message.textContent = '✓ Thank you! Your travel spot suggestion has been submitted successfully.';
        } else if(status === 'error'){
          const err = params.get('msg') ? decodeURIComponent(params.get('msg')) : 'An error occurred while submitting your suggestion.';
          message.style.display = 'block';
          message.className = 'notice';
          message.textContent = 'Error: ' + err;
        }
        // remove query params so message doesn't persist on refresh
        if(window.history && window.history.replaceState){
          const url = new URL(window.location);
          url.search = '';
          window.history.replaceState({}, document.title, url.toString());
        }
      }
    })();

    // District data for each state
    const districtsByState = {
      'Gujarat': ['Ahmedabad', 'Somnath', 'Dwarka', 'Junagadh', 'Kutch', 'Panchmahal', 'Mehsana', 'Vadodara', 'Navsari', 'Diu'],
      'Rajasthan': ['Jaipur', 'Udaipur', 'Jodhpur', 'Jaisalmer', 'Ajmer'],
      'Assam': ['Kamrup', 'Dibrugarh', 'Jorhat', 'Goalpara', 'Tinsukia'],
      'Jammu and Kashmir': ['Srinagar', 'Jammu', 'Anantnag', 'Baramulla', 'Kathua'],
      'Kerala': ['Thiruvananthapuram', 'Kochi', 'Kozhikode', 'Kollam', 'Thrissur']
    };

    // Handle state change to populate districts
    stateSelect.addEventListener('change', () => {
      const selectedState = stateSelect.value;
      districtSelect.innerHTML = '<option value="">Select district</option>';
      
      if (selectedState && districtsByState[selectedState]) {
        districtSelect.disabled = false;
        const districts = districtsByState[selectedState];
        
        if (districts.length > 0) {
          districts.forEach(district => {
            const option = document.createElement('option');
            option.value = district;
            option.textContent = district;
            districtSelect.appendChild(option);
          });
        } else {
          districtSelect.innerHTML = '<option value="">No districts available</option>';
        }
      } else {
        districtSelect.disabled = true;
        districtSelect.innerHTML = '<option value="">Select state first</option>';
      }
    });

    // Back button behaviour (navigate history or fallback)
    backBtn.addEventListener('click', (e)=>{
      e.preventDefault();
      if(history.length>1) history.back(); else window.location.href = '../index.html';
    });

    // image preview & size check
    photo.addEventListener('change', ()=>{
      preview.innerHTML = '';
      const file = photo.files[0];
      if(!file) { preview.textContent = 'Preview'; return; }
      if(file.size > 10 * 1024 * 1024){ // 10MB
        alert('File too large. Please pick an image smaller than 10MB.');
        photo.value = '';
        preview.textContent = 'Preview';
        return;
      }
      const img = document.createElement('img');
      img.alt = 'Uploaded photo preview';
      const reader = new FileReader();
      reader.onload = e => img.src = e.target.result;
      reader.readAsDataURL(file);
      preview.appendChild(img);
    });

    // simple google maps link check
    function looksLikeGoogleMaps(url){
      if(!url) return true; // optional
      try{
        const u = new URL(url);
        return u.hostname.includes('google') && (u.pathname.includes('/maps') || u.pathname.includes('/place'));
      }catch(e){return false}
    }

    form.addEventListener('submit', (e)=>{
      // run client-side validation, then allow normal form submission
      message.style.display = 'none';

      const state = document.getElementById('spotState').value.trim();
      const district = document.getElementById('spotDistrict').value.trim();
      const spot = document.getElementById('spotName').value.trim();
      const desc = document.getElementById('description').value.trim();
      const map = document.getElementById('mapLink').value.trim();

      // basic validation
      if(!state){ alert('Please select a state.'); e.preventDefault(); return; }
      if(!district){ alert('Please select a district.'); e.preventDefault(); return; }
      if(!spot){ alert('Please enter the spot name.'); e.preventDefault(); return; }
      if(!desc){ alert('Please enter a description.'); e.preventDefault(); return; }

      // Passed validation — let the browser submit the form (multipart) to userform.php
      // Optionally show a small UI state: disable submit to avoid duplicates
      const submitBtn = form.querySelector('button[type="submit"]');
      if(submitBtn) { submitBtn.disabled = true; submitBtn.textContent = 'Submitting...'; }
      // allow default submit to proceed
    });

    clearBtn.addEventListener('click', ()=>{ 
      if(confirm('Clear all form fields?')){ 
        form.reset(); 
        preview.textContent = 'Preview'; 
        message.style.display='none';
        districtSelect.disabled = true;
        districtSelect.innerHTML = '<option value="">Select state first</option>';
      } 
    });
  </script>
</body>
</html>